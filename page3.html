<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>UBHACKOPOLY ‚Äì Game Board</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }

  html, body {
    height: 100%;
    font-family: "Poppins", system-ui, sans-serif;
    background: radial-gradient(circle at top, #0b1335, #02040a 85%);
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  .game-container {
    display: grid;
    grid-template-columns: 22% 53% 25%;
    width: min(96vw, 1600px);
    height: min(96vh, 1000px);
    gap: 1rem;
  }

  /* Sidebar */
  .sidebar, .actions {
    backdrop-filter: blur(18px);
    background: rgba(255, 255, 255, 0.08);
    border: 2px solid rgba(255, 255, 255, 0.15);
    border-radius: 20px;
    padding: 1rem;
    box-shadow: 0 8px 30px rgba(0,0,0,0.3);
  }

  .sidebar h2 {
    text-align: center;
    font-size: clamp(1rem, 1.6vw, 1.3rem);
    margin-bottom: 10px;
    color: #00c0ff;
    text-shadow: 0 0 10px rgba(0,180,255,0.8);
  }

  .player-card {
    background: rgba(255,255,255,0.08);
    border-radius: 12px;
    margin-bottom: 0.6rem;
    padding: 0.8rem;
    border-left: 6px solid;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: all .25s ease;
  }

  .player-card.active {
    background: linear-gradient(135deg, #007bff, #5e1fff);
    transform: scale(1.03);
    box-shadow: 0 0 14px #2196f3cc;
  }

  .player-info { flex: 1; }
  .player-name { font-weight: 700; font-size: 1rem; }
  .player-balance { font-size: .9rem; opacity: .9; }

  .player-piece img { width: 36px; height: 36px; object-fit: contain; }

  /* Monopoly-style board */
  .board {
    width: 700px;
    height: 700px;
    display: flex;
    flex-direction: column;
    background: radial-gradient(circle at center, #0a1f3c 30%, #00142e);
    border: 6px solid #00aaff;
    border-radius: 16px;
    position: relative;
    margin: auto;
    box-shadow: 0 0 40px rgba(0, 170, 255, 0.3);
  }

  .board-top,
  .board-bottom {
    display: flex;
    justify-content: space-between;
  }

  .board-middle {
    flex: 1;
    display: flex;
    justify-content: space-between;
    align-items: stretch;
  }

  .board-left,
  .board-right {
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }

  .tile {
    width: 70px;
    height: 70px;
    background: rgba(255, 255, 255, 0.07);
    border: 1px solid rgba(255, 255, 255, 0.15);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.7rem;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.25s ease;
    text-align: center;
  }

  .tile:hover {
    background: rgba(0, 200, 255, 0.25);
    transform: scale(1.05);
  }

  .tile.selected {
    background: rgba(0,200,255,0.4);
    box-shadow: 0 0 10px #00bfff;
  }

  .board-center {
    flex: 1;
    background: rgba(255, 255, 255, 0.06);
    border: 2px solid rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    margin: 5px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: #00cfff;
    font-size: 1.5rem;
    font-weight: bold;
    box-shadow: inset 0 0 20px rgba(0, 150, 255, 0.3);
  }

  /* Actions panel */
  .actions {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .actions button {
    width: 100%;
    padding: 14px;
    border: none;
    border-radius: 12px;
    background: linear-gradient(135deg, #007bff, #4a00e0);
    color: white;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.25s ease;
  }

  .actions button:hover {
    background: linear-gradient(135deg, #00b0ff, #5e1fff);
    transform: translateY(-2px);
    box-shadow: 0 0 25px rgba(90,50,255,0.6);
  }

  .popup {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #007bff, #00b3ff);
    padding: 15px 22px;
    border-radius: 12px;
    font-weight: 600;
    box-shadow: 0 0 25px rgba(0,180,255,0.5);
    opacity: 0;
    transform: translateY(-20px);
    transition: all 0.35s ease;
  }

  .popup.show { opacity: 1; transform: translateY(0); }
</style>
</head>
<body>
<div class="game-container">
  <div class="sidebar" id="playerSidebar"><h2>üéÆ Players</h2></div>

  <div class="board" id="board">
    <div class="board-top">
      <div class="tile">GO</div>
      <div class="tile">Baird</div>
      <div class="tile">Clements</div>
      <div class="tile">Jacobs</div>
      <div class="tile">Baldy</div>
      <div class="tile">Furnas</div>
      <div class="tile">Cooke</div>
      <div class="tile">Slee</div>
      <div class="tile">Ketter</div>
    </div>

    <div class="board-middle">
      <div class="board-left">
        <div class="tile">Capen</div>
        <div class="tile">Student Union</div>
        <div class="tile">Math</div>
        <div class="tile">Science</div>
        <div class="tile">CFA</div>
      </div>

      <div class="board-center" id="center">
        <h2>üé≤ UBopoly</h2>
        <p id="turn-info">Player 1‚Äôs turn</p>
      </div>

      <div class="board-right">
        <div class="tile">Davis</div>
        <div class="tile">Bell</div>
        <div class="tile">Lockwood</div>
        <div class="tile">O‚ÄôBrien</div>
        <div class="tile">Park</div>
      </div>
    </div>

    <div class="board-bottom">
      <div class="tile">South Lake</div>
      <div class="tile">Clemens</div>
      <div class="tile">Silverman</div>
      <div class="tile">UB Stadium</div>
      <div class="tile">C3</div>
      <div class="tile">Fronczak</div>
      <div class="tile">Talbert</div>
      <div class="tile">Spaulding</div>
      <div class="tile">Founders</div>
    </div>
  </div>

  <div class="actions">
    <button id="rollBtn">üé≤ Roll Dice</button>
    <div class="dice-display" id="diceDisplay" style="text-align:center;">‚Äì</div>
    <button id="buyBtn">üí∞ Buy Property</button>
    <button id="endTurnBtn">‚û°Ô∏è End Turn</button>
    <button id="resetBtn">üîÑ Reset Game</button>
  </div>
</div>

<div class="popup" id="popup">Notification</div>

<script>
/* ========= API helper ========= */
const API =
  location.hostname === "localhost" || location.hostname === "127.0.0.1"
    ? "http://127.0.0.1:5000"
    : `${location.origin}`;

async function api(path, options = {}) {
  try {
    const res = await fetch(`${API}${path}`, {
      headers: { "Content-Type": "application/json" },
      ...options,
    });
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || res.statusText);
    return data;
  } catch (err) {
    showPopup(`‚ö†Ô∏è ${err.message}`, "#ff4b5c");
    throw err;
  }
}

/* ========= UI State ========= */
let players = [{ name: "Player 1", balance: 1500 }];
let activePlayer = 0;

/* ========= Sidebar ========= */
function renderSidebar() {
  const sidebar = document.getElementById("playerSidebar");
  sidebar.innerHTML = `<h2>üéÆ Players</h2>`;
  players.forEach((p, i) => {
    const card = document.createElement("div");
    card.className = "player-card" + (i === activePlayer ? " active" : "");
    card.style.borderLeftColor = "#00bfff";
    card.innerHTML = `
      <div class="player-info">
        <div class="player-name">${p.name}</div>
        <div class="player-balance">üíµ $${p.balance}</div>
      </div>
    `;
    sidebar.appendChild(card);
  });
}
renderSidebar();

/* ========= Popup Helper ========= */
function showPopup(msg, color = "#00bfff") {
  const popup = document.getElementById("popup");
  popup.textContent = msg;
  popup.style.background = `linear-gradient(135deg, ${color}, #007bff)`;
  popup.classList.add("show");
  setTimeout(() => popup.classList.remove("show"), 2000);
}

/* ========= Board Click ========= */
let selectedProperty = null;
document.querySelectorAll(".tile").forEach(tile => {
  tile.addEventListener("click", () => {
    document.querySelectorAll(".tile").forEach(t => t.classList.remove("selected"));
    tile.classList.add("selected");
    selectedProperty = tile.textContent.trim();
    showPopup(`Selected: ${selectedProperty}`, "#00e5ff");
  });
});

/* ========= Sync State ========= */
async function syncState() {
  try {
    const data = await api("/state");
    players = data.players.map(p => ({ name: p.name, balance: p.balance }));
    activePlayer = data.active_player ?? 0;
    renderSidebar();
  } catch {
    console.log("Backend not reachable.");
  }
}
syncState();

/* ========= Buttons ========= */
document.getElementById("rollBtn").onclick = async () => {
  try {
    const data = await api("/roll", { method: "POST" });
    document.getElementById("diceDisplay").textContent = `üé≤ ${data.roll}`;
    showPopup(`You rolled a ${data.roll}!`, "#00ffcc");
  } catch {}
};

document.getElementById("buyBtn").onclick = async () => {
  if (!selectedProperty) {
    showPopup("Select a property first!", "#ffb300");
    return;
  }
  try {
    const data = await api("/buy", {
      method: "POST",
      body: JSON.stringify({ property: selectedProperty }),
    });
    showPopup(data.message, "#ffb300");
    await syncState();
  } catch {}
};

document.getElementById("endTurnBtn").onclick = async () => {
  try {
    const data = await api("/end_turn", { method: "POST" });
    showPopup(`Next Player: ${data.next_player}`, "#4a9eff");
    await syncState();
  } catch {}
};

document.getElementById("resetBtn").onclick = async () => {
  try {
    const data = await api("/reset", { method: "POST" });
    showPopup(data.message, "#00ff88");
    await syncState();
  } catch {}
};
</script>
</body>
</html>
